<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°„í˜¸ì‚¬ ì²˜ì¹˜ ê´€ë¦¬</title>

    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background: #f9fafb;
            margin: 0;
            padding: 20px 40px;
        }

        h2 {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 25px;
        }

        .columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .icon-wait {
            width: 12px;
            height: 12px;
            background: #2563eb;
            border-radius: 3px;
        }

        .icon-done {
            width: 12px;
            height: 12px;
            background: #22c55e;
            border-radius: 3px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .left-area {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .item-title {
            font-size: 18px;
            font-weight: 700;
        }

        .sub-info {
            color: #6b7280;
            font-size: 14px;
        }

        .btn-complete {
            padding: 10px 22px;
            background: #22c55e;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 15px;
            cursor: pointer;
        }

        .btn-complete:hover {
            background: #16a34a;
        }

        .done-text {
            color: #22c55e;
            font-weight: 700;
            font-size: 15px;
        }

        .empty {
            padding: 20px;
            text-align: center;
            color: #9ca3af;
        }
    </style>
</head>

<body>

<h2>ğŸ©º ê°„í˜¸ì‚¬ ì²˜ì¹˜ ê´€ë¦¬</h2>

<div class="columns">

    <!-- ğŸŸ¦ ì²˜ì¹˜ ëŒ€ê¸° -->
    <div>
        <div class="section-title">
            <span class="icon-wait"></span> ì²˜ì¹˜ ëŒ€ê¸°
        </div>
        <div id="pending-area">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <!-- ğŸŸ© ì²˜ì¹˜ ì™„ë£Œ -->
    <div>
        <div class="section-title">
            <span class="icon-done"></span> ì²˜ì¹˜ ì™„ë£Œ
        </div>
        <div id="done-area">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

</div>

<script>
/* ---------------------------------------------
    ë°ì´í„° ë¡œë“œ
---------------------------------------------- */
async function loadTasks() {

    // ğŸ”µ ëŒ€ê¸° ì¤‘ ë°ì´í„°
    const pendingRes = await fetch("/api/nurse/task/pending");
    let pending = await pendingRes.json();

    // âœ” ì²˜ì¹˜ + ì£¼ì‚¬
    pending = pending.filter(t =>
        t.itemType === "PROCEDURE" || t.itemType === "INJECTION"
    );
    renderPending(pending);

    // ğŸŸ¢ ì™„ë£Œëœ ë°ì´í„°
    const doneRes = await fetch("/api/nurse/task/done");
    let done = await doneRes.json();

    // âœ” ì²˜ì¹˜ + ì£¼ì‚¬
    done = done.filter(t =>
        t.itemType === "PROCEDURE" || t.itemType === "INJECTION"
    );
    renderDone(done);
}



/* ---------------------------------------------
    ì²˜ì¹˜ ëŒ€ê¸° ë Œë”ë§
---------------------------------------------- */
function renderPending(list) {
    const area = document.getElementById("pending-area");

    if (list.length === 0) {
        area.innerHTML = "<div class='empty'>ëŒ€ê¸° ì¤‘ ì²˜ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
        return;
    }

    area.innerHTML = "";

    list.forEach(task => {
        area.innerHTML += `
            <div class="card">
                <div class="left-area">
                    <div class="item-title">${task.itemName}</div>
                    <div class="sub-info">
                        í™˜ì ID: ${task.patientId}<br>
                        ìœ í˜•: ${task.itemType}
                    </div>
                </div>

                <button class="btn-complete" onclick="completeTask(${task.id})">
                    âœ” ì²˜ì¹˜ ì™„ë£Œ
                </button>
            </div>
        `;
    });
}

/* ---------------------------------------------
    ì²˜ì¹˜ ì™„ë£Œ ë Œë”ë§
---------------------------------------------- */
function renderDone(list) {
    const area = document.getElementById("done-area");

    if (list.length === 0) {
        area.innerHTML = "<div class='empty'>ì²˜ì¹˜ ì™„ë£Œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
        return;
    }

    area.innerHTML = "";

    list.forEach(task => {
        area.innerHTML += `
            <div class="card">
                <div class="left-area">
                    <div class="item-title">${task.itemName}</div>
                    <div class="sub-info">
                        í™˜ì ID: ${task.patientId}<br>
                        ì™„ë£Œ ì‹œê°„: ${task.doneAt || '-'}
                    </div>
                </div>

                <div class="done-text">âœ” ì™„ë£Œ</div>
            </div>
        `;
    });
}

/* ---------------------------------------------
    ì™„ë£Œ ì²˜ë¦¬ API
---------------------------------------------- */
async function completeTask(id) {
    if (!confirm("í•´ë‹¹ ì²˜ì¹˜ë¥¼ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    await fetch(`/api/nurse/task/${id}/complete`, {
        method: "POST"
    });

    loadTasks();
}

/* --------------------------------------------- */
loadTasks();
</script>

</body>
</html>
