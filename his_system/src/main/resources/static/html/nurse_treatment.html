<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì²˜ì¹˜ ê´€ë¦¬ - ê°„í˜¸ì‚¬</title>

    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background: #f9fafb;
            margin: 0;
            padding: 20px;
        }

        .title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .task-item {
            padding: 15px;
            background: #f3f4f6;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .task-item strong {
            font-size: 17px;
        }

        .btn-complete {
            margin-top: 10px;
            padding: 8px 14px;
            border: none;
            background: #22c55e;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-complete:hover {
            background: #16a34a;
        }

        .empty {
            padding: 15px;
            color: #9ca3af;
        }
    </style>
</head>
<body>

<div class="title">ğŸ©º ê°„í˜¸ì‚¬ ì²˜ì¹˜ ê´€ë¦¬</div>

<!-- ëŒ€ê¸° ì¤‘ -->
<div class="section">
    <div class="section-title">â³ ëŒ€ê¸° ì¤‘ ì²˜ì¹˜</div>
    <div id="pending-area" class="empty">ëŒ€ê¸° ì¤‘ ì²˜ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<!-- ì™„ë£Œëœ ì²˜ì¹˜ -->
<div class="section">
    <div class="section-title">âœ… ì™„ë£Œëœ ì²˜ì¹˜</div>
    <div id="done-area" class="empty">ì™„ë£Œëœ ì²˜ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
/* ------------------------------------------
    ë°ì´í„° ë¡œë“œ
-------------------------------------------- */
async function loadTasks() {

    // ëŒ€ê¸° ì¤‘
    const pendingRes = await fetch("/api/nurse/task/pending");
    const pending = await pendingRes.json();

    renderPending(pending);

    // ì™„ë£Œëœ ëª©ë¡
    const doneRes = await fetch("/api/nurse/task/done");
    const done = await doneRes.json();

    renderDone(done);
}

/* ------------------------------------------
    ëŒ€ê¸° ì¤‘ ì²˜ì¹˜ ë Œë”ë§
-------------------------------------------- */
function renderPending(list) {
    const area = document.getElementById("pending-area");

    if (!list || list.length === 0) {
        area.innerHTML = "<div class='empty'>ëŒ€ê¸° ì¤‘ ì²˜ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
        return;
    }

    area.innerHTML = "";

    list.forEach(task => {
        area.innerHTML += `
            <div class="task-item">
                <strong>${task.itemName}</strong>  
                <div style="color:#6b7280;">
                    ìœ í˜•: ${task.itemType}  
                    <br>í™˜ì ID: ${task.patientId}
                </div>

                <button class="btn-complete" onclick="completeTask(${task.id})">
                    âœ” ì²˜ì¹˜ ì™„ë£Œ
                </button>
            </div>
        `;
    });
}

/* ------------------------------------------
    ì™„ë£Œëœ ì²˜ì¹˜ ë Œë”ë§
-------------------------------------------- */
function renderDone(list) {
    const area = document.getElementById("done-area");

    if (!list || list.length === 0) {
        area.innerHTML = "<div class='empty'>ì™„ë£Œëœ ì²˜ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
        return;
    }

    area.innerHTML = "";

    list.forEach(task => {
        area.innerHTML += `
            <div class="task-item" style="background:#e0ffe4;">
                <strong>${task.itemName}</strong>  
                <div style="color:#6b7280;">
                    ìœ í˜•: ${task.itemType}  
                    <br>í™˜ì ID: ${task.patientId}
                    <br>ì™„ë£Œ ì‹œê°„: ${task.doneAt || '-'}
                </div>
            </div>
        `;
    });
}

/* ------------------------------------------
    ì™„ë£Œ ì²˜ë¦¬ API
-------------------------------------------- */
async function completeTask(id) {
    if (!confirm("ì •ë§ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    await fetch(`/api/nurse/task/${id}/complete`, {
        method: "POST"
    });

    loadTasks(); // ìƒˆë¡œê³ ì¹¨
}

/* ------------------------------------------
    í˜ì´ì§€ ë¡œë“œ ì‹œ ë°”ë¡œ ì‹¤í–‰ (ì¤‘ìš”!!)
-------------------------------------------- */
loadTasks();
</script>

</body>
</html>
