<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹œìŠ¤í…œ ë¡œê·¸</title>

    <!-- âœ… ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- ğŸ” ê´€ë¦¬ì ì ‘ê·¼ ì œì–´ -->
    <script src="/js/access.js"></script>
    <script src="/js/app.js"></script>

    <!-- ë¡œê·¸ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ -->
    <style>
        body {
            background: #f8f9fb;
        }

        .summary-boxes {
            display: flex;
            gap: 20px;
            padding: 20px 30px;
        }
        .box {
            flex: 1;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .box-title { font-size: 15px; color: #555; }
        .box-value { margin-top: 8px; font-size: 28px; font-weight: 700; }

        .menu {
            display: flex;
            gap: 20px;
            padding: 0 30px;
            border-bottom: 1px solid #eee;
            background: #fff;
        }
        .menu a {
            padding: 15px 5px;
            font-size: 16px;
            color: #555;
            text-decoration: none;
        }
        .menu a.active {
            font-weight: 700;
            border-bottom: 3px solid #6b50ff;
            color: #6b50ff;
        }

        .content { padding: 25px 30px; }

        .filter-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .filter-box input,
        .filter-box select,
        .filter-box button {
            padding: 8px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        th {
            background: #f3f4f6;
            padding: 12px;
            font-size: 14px;
            text-align: center;
        }
        td {
            padding: 12px;
            border-top: 1px solid #eee;
            font-size: 14px;
            text-align: center;
        }

        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination button {
            padding: 6px 12px;
            margin: 0 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>

<script>
    checkAccess(["ADMIN"]);
</script>

<!-- âœ… ê³µí†µ ê´€ë¦¬ì í—¤ë” -->
<header>
    <div>ê´€ë¦¬ì ì‹œìŠ¤í…œ</div>

    <div class="header-right">
        <div id="admin-name" class="user-info"></div>
        <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</header>

<!-- ìš”ì•½ -->
<div class="summary-boxes">
    <div class="box log-card login">
    <div class="box-title">ë¡œê·¸ì¸</div>
    <div class="box-value" id="loginCount">0íšŒ</div>
</div>

<div class="box log-card logout">
    <div class="box-title">ë¡œê·¸ì•„ì›ƒ</div>
    <div class="box-value" id="logoutCount">0íšŒ</div>
</div>

</div>

<!-- ë©”ë‰´ -->
<div class="menu">
    <a href="/html/admin_dashboard.html">ê³„ì • ê´€ë¦¬</a>
    <a class="active">ì‹œìŠ¤í…œ ë¡œê·¸</a>
</div>

<!-- ë³¸ë¬¸ -->
<div class="content">

    <div class="filter-box">
        <input type="text" id="employeeNo" placeholder="ì§ì›ë²ˆí˜¸">
        <select id="actionType">
            <option value="">ì „ì²´ ì‘ì—…</option>
            <option value="LOGIN">ë¡œê·¸ì¸</option>
            <option value="LOGOUT">ë¡œê·¸ì•„ì›ƒ</option>
        </select>
        <input type="datetime-local" id="from">
        <input type="datetime-local" id="to">
        <button class="action-btn" onclick="loadLogs(0)">ê²€ìƒ‰</button>
    </div>

    <table>
        <thead>
        <tr>
            <th>ì‹œê°„</th>
            <th>ì‚¬ìš©ì</th>
            <th>ì‘ì—…</th>
            <th>ëŒ€ìƒ ID</th>
            <th>ì„¸ë¶€ì‚¬í•­</th>
        </tr>
        </thead>
        <tbody id="logTableBody"></tbody>
    </table>

    <div class="pagination" id="pagination"></div>
</div>

<script>
const name = localStorage.getItem("name");
if (name) {
    document.getElementById("admin-name").innerHTML = `
        <span class="user-name">${name} ë‹˜</span>
        <span class="welcome-text">í™˜ì˜í•©ë‹ˆë‹¤</span>
    `;
}

/* ===== ë¡œê·¸ ë¡œë”© ===== */
async function loadLogs(page) {
    const employeeNo = document.getElementById("employeeNo").value;
    const actionType = document.getElementById("actionType").value;
    const from = document.getElementById("from").value;
    const to = document.getElementById("to").value;

    const params = new URLSearchParams({ page, size: 10 });
    if (employeeNo) params.append("employeeNo", employeeNo);
    if (actionType) params.append("actionType", actionType);
    if (from) params.append("from", from);
    if (to) params.append("to", to);

    const res = await fetch(`/api/admin/system-logs?${params.toString()}`);
    const data = await res.json();

    const tbody = document.getElementById("logTableBody");
    tbody.innerHTML = "";

    const rows = data.content ?? data;

    let loginCnt = 0, logoutCnt = 0;

    rows.forEach(log => {
        if (log.actionType === "LOGIN") loginCnt++;
        if (log.actionType === "LOGOUT") logoutCnt++;

        tbody.innerHTML += `
            <tr>
                <td>${log.createdAt}</td>
                <td>${log.staffName} (${log.employeeNo})</td>
                <td>${log.actionType}</td>
                <td>${log.targetId ?? ""}</td>
                <td>${log.description}</td>
            </tr>
        `;
    });

    document.getElementById("loginCount").innerText = `${loginCnt}íšŒ`;
    document.getElementById("logoutCount").innerText = `${logoutCnt}íšŒ`;

    renderPagination(data);
}

function renderPagination(data) {
    const container = document.getElementById("pagination");
    container.innerHTML = "";
    if (!data.totalPages) return;

    for (let i = 0; i < data.totalPages; i++) {
        container.innerHTML += `<button onclick="loadLogs(${i})">${i + 1}</button>`;
    }
}

window.addEventListener("DOMContentLoaded", () => loadLogs(0));
</script>

</body>
</html>
