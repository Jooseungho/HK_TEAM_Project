<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°„í˜¸ì‚¬ ì—…ë¬´ ì‹œìŠ¤í…œ</title>
<<<<<<< HEAD
    
	<!-- ğŸ”¥ ì¶”ê°€: ì ‘ê·¼ ê¶Œí•œ / ì´ë¦„ í‘œì‹œ / ë¡œê·¸ì•„ì›ƒ / ê³µí†µ í•¨ìˆ˜ -->
    <script src="/js/access.js"></script>
	<script src="/js/app.js"></script>
	
=======

    <!-- ì ‘ê·¼ ê¶Œí•œ / ê³µí†µ í•¨ìˆ˜ -->
    <script src="/js/access.js"></script>
    <script src="/js/app.js"></script>

>>>>>>> parent of 12102fe (OJ)
    <link rel="stylesheet" href="/css/style.css">

    <style>
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: #f9fafb; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 30px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            font-size: 18px;
            font-weight: 600;
        }

        .cards {
            display: flex;
            gap: 15px;
            padding: 20px 30px;
        }

        .card {
            flex: 1;
            background: #eef6ff;
            border-radius: 12px;
            padding: 20px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .card.yellow { background: #fff8dc; }
        .card.green { background: #eafff1; }
        .card-title { color: #555; margin-bottom: 7px; }
        .card-value { font-size: 22px; font-weight: 700; }

        .tabs {
            display: flex;
            padding: 10px 30px 0;
            gap: 35px;
            background: white;
            border-bottom: 1px solid #d1d5db;
            font-size: 17px;
        }

        .tab {
            padding: 10px 4px 14px;
            cursor: pointer;
            color: #4b5563;
        }

        .tab.active {
            font-weight: 700;
            color: #22a45d;
            border-bottom: 3px solid #22a45d;
        }

        #content-area {
            padding: 25px 30px;
        }
    </style>
</head>

<body>

<header>
    <div style="display:flex; align-items:center; gap:10px;">
        ê°„í˜¸ì‚¬ ì—…ë¬´ ì‹œìŠ¤í…œ
    </div>
<<<<<<< HEAD
    <div style="display:flex; align-items:center; gap:12px;">

        <!-- ğŸ”¥ ì‚¬ìš©ì ì´ë¦„ í‘œì‹œìš© ì˜ì—­ -->
        <div id="nurse-name"></div>

        <!-- ğŸ”¥ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
        <button onclick="logout()" 
                style="padding:8px 15px; cursor:pointer;">
=======

    <div style="display:flex; align-items:center; gap:12px;">
        <div id="nurse-name"></div>
        <button onclick="logout()" style="padding:8px 15px; cursor:pointer;">
>>>>>>> parent of 12102fe (OJ)
            ë¡œê·¸ì•„ì›ƒ
        </button>
    </div>
</header>

<<<<<<< HEAD
<!-- ğŸ”¥ ì¶”ê°€: í˜ì´ì§€ ë¡œë”© ì§í›„ ê¶Œí•œ ê²€ì‚¬ -->
<script>
    checkAccess(["NURSE"]);
    // ì´ìœ : ê°„í˜¸ì‚¬ ëŒ€ì‹œë³´ë“œëŠ” NURSE ê³„ì •ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•¨
=======
<!-- ê¶Œí•œ ì²´í¬ -->
<script>
    checkAccess(["NURSE"]);
>>>>>>> parent of 12102fe (OJ)
</script>

<!-- ìƒë‹¨ ì¹´ë“œ -->
<div class="cards">
    <div class="card">
        <div class="card-title">ì´ ì ‘ìˆ˜</div>
        <div class="card-value" id="total-count">0ëª…</div>
    </div>
    <div class="card yellow">
        <div class="card-title">ëŒ€ê¸° ì¤‘</div>
        <div class="card-value" id="waiting-count">0ëª…</div>
    </div>
    <div class="card green">
        <div class="card-title">ì§„ë£Œ ì™„ë£Œ</div>
        <div class="card-value" id="done-count">0ëª…</div>
    </div>
    <div class="card" style="background:#f6e8ff;">
        <div class="card-title">ë“±ë¡ í™˜ì</div>
        <div class="card-value" id="patient-count">0ëª…</div>
    </div>
</div>

<!-- íƒ­ -->
<div class="tabs">
    <div class="tab active" data-tab="patient_register">í™˜ì ë“±ë¡</div>
    <div class="tab" data-tab="visit_register">í™˜ì ì ‘ìˆ˜</div>
    <div class="tab" data-tab="nurse_treatment">ì²˜ì¹˜ ê´€ë¦¬</div>
    <div class="tab" data-tab="nurse_bill">ìˆ˜ë‚© ì²˜ë¦¬</div>
    <div class="tab" data-tab="nurse_document">ë¬¸ì„œ ì¡°íšŒ</div>
</div>

<!-- ì½˜í…ì¸  -->
<div id="content-area"></div>

<script>
/* ------------------------------------------
   íƒ­ í´ë¦­
------------------------------------------ */
document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        loadTabContent(tab.dataset.tab);
    });
});

/* ------------------------------------------
   íƒ­ ì½˜í…ì¸  ë¡œë”©
------------------------------------------ */
function loadTabContent(file) {
    fetch(`/html/${file}.html`)
        .then(res => res.text())
        .then(html => {
            const contentArea = document.getElementById("content-area");
            contentArea.innerHTML = html;

            // script ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            const scripts = contentArea.querySelectorAll("script");


//             scripts.forEach(scriptTag => {
//                 const newScript = document.createElement("script");
//                 newScript.text = scriptTag.innerHTML;
//                 document.body.appendChild(newScript);
//                 scriptTag.remove();
//             });
           // ìˆ˜ì • -------------------------------------
           //    íƒ­ì„ í´ë¦­í• ë•Œë§ˆë‹¤ í•´ë‹¹ í˜ì´ì§€ì˜ tagì™€ scriptë¥¼ ë¶„ë¦¬í•´ì„œ append í•´ì£¼ëŠ”ë° 
           //    í´ë¦­í• ë•Œë§ˆë‚˜ ë™ì¼í•œ ì½”ë“œê°€ ë°˜ë³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì„œ ì¤‘ë³µ ì˜¤ë¥˜ ë°œìƒë˜ëŠ” ë¬¸ì œì  í•´ê²°
			scripts.forEach(scriptTag => {
			    const scriptId = scriptTag.dataset.scriptId;
			
			    // ì´ë¯¸ ë¡œë“œëœ scriptë¼ë©´ skip
			    if (scriptId && document.querySelector(`script[data-loaded-id="${scriptId}"]`)) {
			        scriptTag.remove();
			        return;
			    }
			
			    const newScript = document.createElement("script");
			    if (scriptId) newScript.dataset.loadedId = scriptId;
			
			    newScript.text = scriptTag.innerHTML;
			    document.body.appendChild(newScript);
			    scriptTag.remove();
			});
			// ìˆ˜ì • -------------------------------------



            // íƒ­ë³„ ì´ˆê¸° í•¨ìˆ˜
            if (file === "patient_register" && typeof loadPatientRegisterList === "function") {
                loadPatientRegisterList();
            }
            if (file === "visit_register" && typeof initVisitRegisterPage === "function") {
                initVisitRegisterPage();
            }
        });
}

/* ------------------------------------------
   í™˜ì ëª©ë¡
------------------------------------------ */
function loadPatientList() {
    fetch("/api/patient/list")
        .then(res => res.json())
        .then(list => renderPatientList(list))
        .catch(err => console.error("í™˜ì ëª©ë¡ ì˜¤ë¥˜:", err));
}

function renderPatientList(list) {
    const area = document.getElementById("patient-list");
    if (!area) return;

    area.innerHTML = "";

    list.forEach(p => {
        area.innerHTML += `
            <div style="padding:15px 10px; border-bottom:1px solid #e5e7eb;">
                <strong>${p.name}</strong>
                <span style="color:#22a45d; font-size:12px;">(${p.gender})</span><br>
                ì°¨íŠ¸ë²ˆí˜¸: ${p.chartNo}<br>
                ìƒë…„ì›”ì¼: ${p.birthdate}<br>
                ì—°ë½ì²˜: ${p.phone}<br>
                ì£¼ì†Œ: ${p.address}
            </div>
        `;
    });
}
/* ------------------------------------------
ğŸ”¥ [ì¶”ê°€] ìƒë‹¨ ì¹´ë“œ ì¹´ìš´íŠ¸ ë¡œë“œ (ìµœì†Œ ë³€ê²½)
------------------------------------------ */
async function loadNurseDashboardCounts() {
 const res = await fetch("/api/visit/status_counts");
 if (!res.ok) return;

 const data = await res.json();

 const total =
     (data.WAITING ?? 0) +
     (data.IN_TREATMENT ?? 0) +
     (data.DONE ?? 0);

 document.getElementById("total-count").innerText = `${total}ëª…`;
 document.getElementById("waiting-count").innerText = `${data.WAITING ?? 0}ëª…`;
 document.getElementById("done-count").innerText = `${data.DONE ?? 0}ëª…`;
}

/* ------------------------------------------
   ì‹ ê·œ ë“±ë¡ ì´ë™
------------------------------------------ */
function openPatientRegister() {
    loadTabContent("patient_register_form");
}

/* ------------------------------------------
   ì´ˆê¸° ë¡œë”©
------------------------------------------ */
loadTabContent("patient_register");
loadNurseDashboardCounts();

/* ğŸ”¥ ì‚¬ìš©ì ì´ë¦„ ë°•ìŠ¤ ì—…ë°ì´íŠ¸ */

window.addEventListener("load", () => {
    const name = localStorage.getItem("name");
    if (name) {
        document.getElementById("nurse-name").innerText = `${name} ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`;
    }
});

</script>

</body>
</html>
 