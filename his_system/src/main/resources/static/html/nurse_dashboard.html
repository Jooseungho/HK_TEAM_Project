<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°„í˜¸ì‚¬ ì—…ë¬´ ì‹œìŠ¤í…œ</title>

    <link rel="stylesheet" href="/css/style.css">

    <style>
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: #f9fafb; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 30px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            font-size: 18px;
            font-weight: 600;
        }

        .cards {
            display: flex;
            gap: 15px;
            padding: 20px 30px;
        }

        .card {
            flex: 1;
            background: #eef6ff;
            border-radius: 12px;
            padding: 20px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .card.yellow { background: #fff8dc; }
        .card.green { background: #eafff1; }
        .card-title { color: #555; margin-bottom: 7px; }
        .card-value { font-size: 22px; font-weight: 700; }

        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            padding: 10px 30px 0;
            gap: 35px;
            background: white;
            border-bottom: 1px solid #d1d5db;
            font-size: 17px;
        }

        .tab {
            padding: 10px 4px 14px;
            cursor: pointer;
            color: #4b5563;
        }

        .tab.active {
            font-weight: 700;
            color: #22a45d;
            border-bottom: 3px solid #22a45d;
        }

        /* ì½˜í…ì¸  ì˜ì—­ */
        #content-area {
            padding: 25px 30px;
        }
    </style>
</head>

<body>

<header>
    <div style="display:flex; align-items:center; gap:10px;">
        <img src="/static/icon.svg" width="30">
        ê°„í˜¸ì‚¬ ì—…ë¬´ ì‹œìŠ¤í…œ
    </div>
    <div>ë¡œê·¸ì•„ì›ƒ</div>
</header>

<!-- ìƒë‹¨ ì¹´ë“œ -->
<div class="cards">
    <div class="card">
        <div class="card-title">ì´ ì ‘ìˆ˜</div>
        <div class="card-value" id="total-count">0ëª…</div>
    </div>
    <div class="card yellow">
        <div class="card-title">ëŒ€ê¸° ì¤‘</div>
        <div class="card-value" id="waiting-count">0ëª…</div>
    </div>
    <div class="card green">
        <div class="card-title">ì§„ë£Œ ì™„ë£Œ</div>
        <div class="card-value" id="done-count">0ëª…</div>
    </div>
    <div class="card" style="background:#f6e8ff;">
        <div class="card-title">ë“±ë¡ í™˜ì</div>
        <div class="card-value" id="patient-count">0ëª…</div>
    </div>
</div>

<!-- íƒ­ ë©”ë‰´ -->
<div class="tabs">
    <div class="tab active" data-tab="patient_register">í™˜ì ë“±ë¡</div>
    <div class="tab" data-tab="visit_register">í™˜ì ì ‘ìˆ˜</div>
    <div class="tab" data-tab="nurse_treatment">ì²˜ì¹˜ ê´€ë¦¬</div>
    <div class="tab" data-tab="nurse_bill">ìˆ˜ë‚© ì²˜ë¦¬</div>
    <div class="tab" data-tab="nurse_document">ë¬¸ì„œ ì¡°íšŒ</div>
</div>

<!-- íƒ­ ì½˜í…ì¸  ì˜ì—­ -->
<div id="content-area"></div>

<script>
/* ------------------------------------------
   1) íƒ­ í´ë¦­ ì‹œ â†’ HTML ë¶ˆëŸ¬ì™€ ì‚½ì…
------------------------------------------ */
document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        let file = tab.dataset.tab;
        loadTabContent(file);
    });
});

/* ------------------------------------------
   2) HTML íŒŒì¼ fetch â†’ content-areaì— ì‚½ì…
------------------------------------------ */
function loadTabContent(file) {
    fetch(`/html/${file}.html`)
        .then(res => res.text())
        .then(html => {
            const contentArea = document.getElementById("content-area");
            contentArea.innerHTML = html;

            // script ì‹¤í–‰
            const scripts = contentArea.querySelectorAll("script");
            scripts.forEach(scriptTag => {
                const newScript = document.createElement("script");
                newScript.text = scriptTag.innerHTML;
                document.body.appendChild(newScript);
                scriptTag.remove();
            });

            // ğŸ”¥ íƒ­ë³„ ì´ˆê¸° í•¨ìˆ˜ ì‹¤í–‰
            if (file === "patient_register") {
                if (typeof loadPatientRegisterList === "function") loadPatientRegisterList();
            }
            if (file === "visit_register") {
                if (typeof loadVisitRegisterList === "function") loadVisitRegisterList();
            }
        });
}



/* ------------------------------------------
   3) í™˜ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ (ì „ì—­ ë“±ë¡)
------------------------------------------ */
function loadPatientList() {
    fetch("/api/patient/list")
        .then(res => res.json())
        .then(list => renderPatientList(list))
        .catch(err => console.error("í™˜ì ëª©ë¡ ì˜¤ë¥˜:", err));
}

function renderPatientList(list) {
    const area = document.getElementById("patient-list");
    if (!area) return;

    area.innerHTML = "";

    list.forEach(p => {
        area.innerHTML += `
            <div style="padding:15px 10px; border-bottom:1px solid #e5e7eb;">
                <strong>${p.name}</strong>
                <span style="color:#22a45d; font-size:12px;">(${p.gender})</span><br>
                ì°¨íŠ¸ë²ˆí˜¸: ${p.chartNo}<br>
                ìƒë…„ì›”ì¼: ${p.birthdate}<br>
                ì—°ë½ì²˜: ${p.phone}<br>
                ì£¼ì†Œ: ${p.address}
            </div>
        `;
    });
}

/* ------------------------------------------
   4) ì‹ ê·œ ë“±ë¡ ë²„íŠ¼
------------------------------------------ */
function openPatientRegister() {
    loadTabContent("patient_register_form");
}

/* ------------------------------------------
   5) ì²« ë¡œë”© â†’ í™˜ìë“±ë¡ íƒ­ í‘œì‹œ
------------------------------------------ */
loadTabContent("patient_register");

</script>

</body>
</html>
