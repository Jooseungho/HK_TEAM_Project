<h2 style="font-size:26px; font-weight:700; margin-bottom:10px;">대기 중인 환자</h2>
<p style="color:#6b7280; margin-bottom:25px;">
    총 <span id="waiting-count-text">0</span>명이 대기 중입니다.
</p>

<div id="waiting-list"></div>

<script>
async function loadDoctorWaiting() {
    const res = await fetch("/api/visit/waiting_list");
    const list = await res.json();

    document.getElementById("waiting-count-text").innerText = list.length;

    const area = document.getElementById("waiting-list");
    area.innerHTML = "";

    list.forEach((item, idx) => {

        const p = item.patient ?? {};
        const v = item.vital ?? {};

        const name = p.name ?? "-";
        const chartNo = p.chartNo ?? "-";
        const time = item.arrivalTime ? item.arrivalTime.substring(11,16) : "-";

        const bp = (v.bpSystolic && v.bpDiastolic) ? `${v.bpSystolic}/${v.bpDiastolic}` : "-";
        const pulse = v.heartRate ?? "-";
        const temp = v.temperature ?? "-";
        const symptom = v.memo ?? "-";

        area.innerHTML += `
            <div style="
                background:white;
                padding:25px;
                border-radius:14px;
                box-shadow:0 3px 10px rgba(0,0,0,0.06);
                margin-bottom:20px;
            ">

                <div style="display:flex; justify-content:space-between;">
                    <div style="display:flex; gap:15px;">
                        <div style="
                            background:#fde047;
                            padding:10px 18px;
                            border-radius:12px;
                            font-size:20px;
                            font-weight:700;
                        ">
                            ${idx + 1}
                        </div>

                        <div>
                            <div style="font-size:18px; font-weight:700;">${name}</div>
                            <div style="color:#6b7280; font-size:14px;">${chartNo}</div>
                            <div style="color:#6b7280; margin-top:4px;">⏱ ${time}</div>
                        </div>
                    </div>

                    <button onclick="callPatient(${item.id})"
                        style="
                            background:#2563eb;
                            color:white;
                            border:none;
                            padding:10px 20px;
                            border-radius:10px;
                            font-size:16px;
                            cursor:pointer;
                        ">
                        호출
                    </button>
                </div>

                <div style="
                    background:#f8fafc;
                    margin-top:20px;
                    padding:20px;
                    border-radius:12px;
                    display:flex;
                    justify-content:space-between;
                ">
                    <div>
                        <div style="font-weight:700;">혈압</div>
                        <div>${bp}</div>
                    </div>
                    <div>
                        <div style="font-weight:700;">맥박</div>
                        <div>${pulse} bpm</div>
                    </div>
                    <div>
                        <div style="font-weight:700;">체온</div>
                        <div>${temp}℃</div>
                    </div>
                    <div>
                        <div style="font-weight:700;">증상</div>
                        <div>${symptom}</div>
                    </div>
                </div>

            </div>
        `;
    });
}

async function callPatient(visitId) {

    await fetch(`/api/visit/call/${visitId}/1`, { method: "POST" });

    sessionStorage.setItem("currentVisitId", visitId);

    location.href = "/html/doctor_dashboard.html#record";
}

// 실행
loadDoctorWaiting();
</script>
